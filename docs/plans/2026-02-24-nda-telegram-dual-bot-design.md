# Design: NDA-–∞–≥–µ–Ω—Ç + –¥–≤–æ–π–Ω–æ–π Telegram-–±–æ—Ç

Date: 2026-02-24

## –ü—Ä–æ–±–ª–µ–º—ã

### P0: Gateway —Ä–µ—Å—Ç–∞—Ä—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤ NDA
`ensureNdaProviderConfigured` (app.ts) –≤—ã–∑—ã–≤–∞–µ—Ç `config.patch` –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤ NDA-—Ä–µ–∂–∏–º, –¥–∞–∂–µ –µ—Å–ª–∏ `nda_internal` –ø—Ä–æ–≤–∞–π–¥–µ—Ä —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç gateway ‚Üí –ø–æ—Ç–µ—Ä—é —Å—Ç—Ä–∏–º–∞ ‚Üí –ø—É—Å—Ç—ã–µ –ø—É–∑—ã—Ä—å–∫–∏ + –¥–≤–æ–π–Ω—ã–µ Telegram-–±–∞–Ω–Ω–µ—Ä—ã.

**–§–∏–∫—Å:** –≤ –Ω–∞—á–∞–ª–µ `ensureNdaProviderConfigured` –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ –≤—ã—Ö–æ–¥–∏—Ç—å –µ—Å–ª–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.

### P1: NDA CTA –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –î–≤–∞ –±–∞–Ω–Ω–µ—Ä–∞ Telegram –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–æ–±—ã—á–Ω—ã–π + NDA)
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å NDA-–±–æ—Ç–∞" –≤–µ–¥—ë—Ç –≤ Telegram-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑ NDA-—Å–µ–∫—Ü–∏–∏
- –õ–æ–≥–∏–∫–∞ `shouldShowNdaTelegramCta` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `isTelegramReadyForCta` (—Å—Ç–∞—Ç—É—Å –ª—é–±–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞) –≤–º–µ—Å—Ç–æ NDA-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

## –î–∏–∑–∞–π–Ω

### Telegram UI: –¥–≤–µ —Å–µ–∫—Ü–∏–∏

```
Telegram
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üë§ –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (–∞–≥–µ–Ω—Ç ¬´–û–±—ã—á–Ω—ã–π¬ª)
   Bot Token: [_______] [–ü–æ–¥–∫–ª—é—á–∏—Ç—å]
   Telegram –ª–æ–≥–∏–Ω/ID: [__________]

üîí NDA-—Ä–µ–∂–∏–º (–∞–≥–µ–Ω—Ç ¬´NDA¬ª)
   Bot Token: [_______] [–ü–æ–¥–∫–ª—é—á–∏—Ç—å NDA-–±–æ—Ç–∞]
   Telegram –ª–æ–≥–∏–Ω/ID: [__________]
   (muted) –û—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç ‚Äî NDA-–∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ —Å–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Å –æ–±—ã—á–Ω—ã–º
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

–ö–∞–∂–¥–∞—è —Å–µ–∫—Ü–∏—è –∏–º–µ–µ—Ç —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (flow state).

### Config patch –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ NDA-–±–æ—Ç–∞

```json
{
  "channels": {
    "telegram": {
      "accounts": {
        "nda": {
          "botToken": "<TOKEN>",
          "allowFrom": ["@username"],
          "dmPolicy": "allowlist"
        }
      }
    }
  },
  "bindings": [
    { "agentId": "main", "match": { "channel": "telegram", "accountId": "default" }},
    { "agentId": "nda",  "match": { "channel": "telegram", "accountId": "nda" }}
  ]
}
```

–ë–∏–Ω–¥–∏–Ω–≥ `main` –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø–∞—Ç—á –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ NDA, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–∏–Ω–¥–∏–Ω–≥ (–º–∞—Å—Å–∏–≤ `bindings` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º).

### –õ–æ–≥–∏–∫–∞ CTA

**Regular CTA** (`shouldShowFirstGreetingCta`): –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ `isTelegramReadyForCta` = true.

**NDA CTA** (`shouldShowNdaTelegramCta`): —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ `channels.telegram.accounts.nda.botToken` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ configSnapshot (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞, –Ω–µ —Å—Ç–∞—Ç—É—Å–∞).

### onOpenNdaTelegramSetup
–û—Ç–∫—Ä—ã–≤–∞–µ—Ç Telegram-–ø–∞–Ω–µ–ª—å. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç `focusNdaSection: true` ‚Üí NDA-—Å–µ–∫—Ü–∏—è –≤–∏–¥–∏–º–∞, –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è –≤ view.

## –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `ui/src/ui/app.ts` | +`@state telegramNdaConnectFlow/Status/Details`, `handleTelegramNdaConnect()`, fix `ensureNdaProviderConfigured` |
| `ui/src/ui/views/channels.types.ts` | +NDA connect flow props –≤ `ChannelsProps` |
| `ui/src/ui/views/channels.telegram.ts` | +NDA —Å–µ–∫—Ü–∏—è —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º flow |
| `ui/src/ui/app-render.ts` | wire NDA props, –æ–±–Ω–æ–≤–∏—Ç—å `shouldShowNdaTelegramCta` |
| `ui/src/ui/app-render-product.ts` | wire NDA props, –æ–±–Ω–æ–≤–∏—Ç—å `shouldShowNdaTelegramCta` |

## –ù–µ –≤ —ç—Ç–æ–º —Å–∫–æ—É–ø–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 3+ –∞–≥–µ–Ω—Ç–æ–≤ —Å Telegram (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- Per-group –∏–ª–∏ per-thread routing –¥–ª—è NDA
