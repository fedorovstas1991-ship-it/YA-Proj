# Kimi 2.5 Onboarding + Default Model Design (YAgent)

## Цель
Заменить текущий Sonnet-онбординг на Kimi 2.5 и сделать первый экран онбординга прикладным: пользователь должен явно пройти путь получения рабочего токена (quota -> "Получить токен" -> вставить `y1_...`).

## Принятые решения
- Модель по умолчанию в текущем UX переводим на `moonshotai/kimi-k2.5`.
- Провайдер в онбординге: `openrouter`.
- Базовый URL: `https://api.eliza.yandex.net/raw/openrouter/v1`.
- Кнопку `Пропустить` удаляем.
- Ввод токена валидируем на клиенте (префикс `y1_` + минимальная длина), кнопка подключения блокируется до валидного значения.
- Визуальный текст онбординга переводим на сценарий получения токена с переходом на quota-страницу.
- Для консистентности выносим пресет Kimi в отдельный модуль и используем его в онбординге и связанных текстах UI.

## UX
### Экран токена (онбординг)
Пользователь видит:
1. Короткую инструкцию: перейти на [quota](https://ai.yandex-team.ru/quota).
2. Подсказку: нажать `Получить токен`.
3. Поле ввода с placeholder вида `y1__xDov6eRpdT...`.
4. Единственную CTA-кнопку `Подключить`.

Поведение:
- Пока токен не похож на `y1_...`, `Подключить` disabled.
- При невалидном токене показывается понятная подсказка, что нужен токен из quota.

### Тексты в UI
- Убираем упоминания Claude/Sonnet в активных местах, связанных с онбордингом и моделью по умолчанию.
- В настройках агента API-лейбл делаем нейтральным (`API ключ Eliza/OpenRouter`).

## Архитектура
- Новый модуль-пресет: `src/onboarding/kimi-preset.ts`.
- `onboarding-api-key.ts` использует preset-константы для текста, ссылки и валидации.
- `onboarding-wizard.ts` формирует `config.patch` только через preset (без хардкода Sonnet).
- Gateway API/контракты не меняем; только значения patch.

## Data Flow
1. Пользователь вводит токен в компоненте `onboarding-api-key`.
2. Компонент валидирует формат `y1_...` и разрешает отправку.
3. `onboarding-wizard` строит patch с `openrouter + kimi-k2.5`.
4. Вызывается `config.get` -> `config.patch`.
5. При успехе отправляется `onboarding-complete` и UI переключается в основной режим.

## Patch-конфиг (целевой)
- `models.mode = "replace"`
- `models.providers.openrouter.baseUrl = "https://api.eliza.yandex.net/raw/openrouter/v1"`
- `models.providers.openrouter.api = "openai-completions"`
- `models.providers.openrouter.apiKey = <user token>`
- `models.providers.openrouter.models = [{ id: "moonshotai/kimi-k2.5", name: "Kimi K2.5" }]`
- `agents.defaults.model.primary = "openrouter/moonshotai/kimi-k2.5"`
- `plugins.slots.memory = "none"` (сохраняем текущее поведение)

## Риски и ограничения
- Если токен не из quota или просрочен, patch пройдет, но модель может не отвечать на рантайме; это ожидаемо и обрабатывается текущими ошибками подключения.
- Изменение касается активного онбординг-потока; legacy `.bak` файлы не трогаем.
- Скрипт reset уже запускает fresh-сценарий, поэтому отдельная миграция старых Sonnet-конфигов не требуется.

## Проверка результата
1. Новый запуск онбординга: нет кнопки `Пропустить`.
2. Невалидный токен: `Подключить` disabled.
3. Валидный `y1_...`: выполняется patch и онбординг завершается.
4. В конфиге после онбординга установлены `openrouter + moonshotai/kimi-k2.5`.
5. Пользовательские тексты не содержат Sonnet/Claude в соответствующих экранах онбординга.
